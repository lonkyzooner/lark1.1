<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LARK UniHiker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #001a3a;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .container {
            width: 240px;
            height: 240px;
            margin: 0 auto;
            border: 2px solid #0055aa;
            background-color: #001a3a;
            position: relative;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            height: 20px;
            background-color: #000c1a;
            width: 100%;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .title {
            font-weight: bold;
            font-size: 14px;
        }
        
        .status {
            display: flex;
            align-items: center;
        }
        
        .mic-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .mic-active {
            background-color: #00cc00;
        }
        
        .mic-inactive {
            background-color: #cc0000;
        }
        
        .battery {
            display: flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .battery-icon {
            width: 20px;
            height: 10px;
            border: 1px solid white;
            border-radius: 2px;
            position: relative;
            margin-right: 5px;
        }
        
        .battery-icon:after {
            content: '';
            position: absolute;
            width: 2px;
            height: 4px;
            background: white;
            top: 3px;
            right: -3px;
        }
        
        .battery-level {
            height: 8px;
            background-color: #00cc00;
            width: 80%;
        }
        
        .battery-text {
            font-size: 10px;
        }
        
        .main-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #0077cc;
            position: absolute;
            top: 80px;
            left: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
        
        .status-text {
            position: absolute;
            width: 100%;
            text-align: center;
            bottom: 80px;
            font-size: 12px;
        }
        
        .message-box {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: 30px;
            background-color: #000c1a;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }
        
        .button {
            background-color: #0055aa;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .button-container {
            position: absolute;
            bottom: 50px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .connection-status {
            position: absolute;
            top: 30px;
            width: 100%;
            text-align: center;
            font-size: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .connection-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .connected {
            background-color: #00cc00;
        }
        
        .disconnected {
            background-color: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">LARK v1.4</div>
            <div class="status">
                <div class="mic-status mic-inactive" id="micStatus"></div>
                <div class="battery">
                    <div class="battery-icon">
                        <div class="battery-level"></div>
                    </div>
                    <div class="battery-text">85%</div>
                </div>
            </div>
        </div>
        
        <div class="connection-status">
            <div class="connection-indicator disconnected" id="connectionIndicator"></div>
            <span id="connectionText">Disconnected</span>
        </div>
        
        <div class="main-circle" id="mainCircle">LARK</div>
        
        <div class="status-text" id="statusText">Ready</div>
        
        <div class="button-container">
            <button class="button" id="mirandaButton">Miranda</button>
            <button class="button" id="statuteButton">Statute</button>
        </div>
        
        <div class="message-box" id="messageBox">Welcome to LARK</div>
    </div>

    <script>
        // States
        const STATE_READY = 0;
        const STATE_LISTENING = 1;
        const STATE_PROCESSING = 2;
        const STATE_RESPONDING = 3;
        
        // Current state
        let currentState = STATE_READY;
        let micActive = false;
        
        // Elements
        const micStatus = document.getElementById('micStatus');
        const mainCircle = document.getElementById('mainCircle');
        const statusText = document.getElementById('statusText');
        const messageBox = document.getElementById('messageBox');
        const mirandaButton = document.getElementById('mirandaButton');
        const statuteButton = document.getElementById('statuteButton');
        const connectionIndicator = document.getElementById('connectionIndicator');
        const connectionText = document.getElementById('connectionText');
        
        // Colors
        const STATE_COLORS = ['#0077cc', '#00cc00', '#cccc00', '#cc00cc'];
        
        // Miranda rights
        const MIRANDA_RIGHTS = [
            "You have the right to remain silent.",
            "Anything you say can be used against you in court.",
            "You have the right to an attorney.",
            "If you cannot afford an attorney, one will be appointed for you."
        ];
        
        // Louisiana statutes
        const STATUTES = {
            "14:98": "DWI - Operating vehicle while intoxicated"
        };
        
        // Server settings
        const SERVER_IP = "10.1.2.101";
        const SERVER_PORT = 8088;
        const SERVER_URL = `http://${SERVER_IP}:${SERVER_PORT}`;
        
        // Update UI based on state
        function updateUI() {
            // Update mic status
            if (micActive) {
                micStatus.classList.remove('mic-inactive');
                micStatus.classList.add('mic-active');
            } else {
                micStatus.classList.remove('mic-active');
                micStatus.classList.add('mic-inactive');
            }
            
            // Update main circle color
            mainCircle.style.borderColor = STATE_COLORS[currentState];
            
            // Update status text
            const statusTexts = [
                "Ready",
                "Listening",
                "Processing",
                "Responding"
            ];
            statusText.textContent = statusTexts[currentState];
        }
        
        // Check server connection
        function checkServerConnection() {
            fetch(`${SERVER_URL}/api/status`, { mode: 'no-cors' })
                .then(() => {
                    connectionIndicator.classList.remove('disconnected');
                    connectionIndicator.classList.add('connected');
                    connectionText.textContent = 'Connected';
                })
                .catch(() => {
                    connectionIndicator.classList.remove('connected');
                    connectionIndicator.classList.add('disconnected');
                    connectionText.textContent = 'Disconnected';
                });
        }
        
        // Send command to server
        function sendCommandToServer(command) {
            fetch(`${SERVER_URL}/api/command`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ command: command }),
                mode: 'no-cors'
            }).catch(error => {
                console.error('Error:', error);
            });
        }
        
        // Run Miranda rights demo
        function runMiranda() {
            // Update state
            currentState = STATE_LISTENING;
            micActive = true;
            updateUI();
            
            // Send command to server
            sendCommandToServer('miranda');
            
            // Simulate processing
            setTimeout(() => {
                currentState = STATE_PROCESSING;
                updateUI();
                
                // Simulate response
                setTimeout(() => {
                    currentState = STATE_RESPONDING;
                    updateUI();
                    
                    // Display Miranda rights
                    let rightIndex = 0;
                    const mirandaInterval = setInterval(() => {
                        messageBox.textContent = MIRANDA_RIGHTS[rightIndex];
                        rightIndex++;
                        
                        if (rightIndex >= MIRANDA_RIGHTS.length) {
                            clearInterval(mirandaInterval);
                            
                            // Return to ready state
                            setTimeout(() => {
                                currentState = STATE_READY;
                                micActive = false;
                                updateUI();
                                messageBox.textContent = "Welcome to LARK";
                            }, 2000);
                        }
                    }, 3000);
                }, 2000);
            }, 2000);
        }
        
        // Run statute lookup demo
        function runStatute() {
            // Update state
            currentState = STATE_LISTENING;
            micActive = true;
            updateUI();
            
            // Send command to server
            sendCommandToServer('statute 14:98');
            
            // Simulate processing
            setTimeout(() => {
                currentState = STATE_PROCESSING;
                updateUI();
                
                // Simulate response
                setTimeout(() => {
                    currentState = STATE_RESPONDING;
                    updateUI();
                    
                    // Display statute
                    messageBox.textContent = "Louisiana Statute 14:98";
                    
                    setTimeout(() => {
                        messageBox.textContent = STATUTES["14:98"];
                        
                        // Return to ready state
                        setTimeout(() => {
                            currentState = STATE_READY;
                            micActive = false;
                            updateUI();
                            messageBox.textContent = "Welcome to LARK";
                        }, 3000);
                    }, 3000);
                }, 2000);
            }, 2000);
        }
        
        // Event listeners
        mirandaButton.addEventListener('click', runMiranda);
        statuteButton.addEventListener('click', runStatute);
        
        // Initial UI update
        updateUI();
        
        // Check connection periodically
        checkServerConnection();
        setInterval(checkServerConnection, 5000);
    </script>
</body>
</html>
